#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/init.h>
#include <linux/kmod.h>

int get_root(void) {
    char *envp[] = {"HOME=/", NULL};
    char *argv[] = {"/bin/bash", "-c", "/bin/echo foo > /bar", NULL};
    printk(KERN_INFO, "Calling custom command\n");
    call_usermodehelper(argv[0], argv, envp, UMH_WAIT_EXEC);
    printk(KERN_INFO, "Done\n");
    return 0;
}

int init_module(void) {
    printk(KERN_INFO, "Hi\n");
    get_root();
    return 0;
}

void cleanup_module(void) {
    printk(KERN_INFO, "Goodbye\n");
}
